version: v1.1.0
steps:
  - cmd: bash -c "docker version"
  - cmd: bash -c "docker buildx version || true"

  # Create and use a buildx builder
  - cmd: bash -c "docker buildx create --use --name multiarchbuilder || docker buildx use multiarchbuilder"

  # Build + push multi-platform image
  - cmd: >
      bash -c "
      docker buildx build
      --platform linux/amd64,linux/arm64
      -t {{.Run.Registry}}/flaskapp:{{.Run.ID}}
      -t {{.Run.Registry}}/flaskapp:latest
      --push
      .
      "
